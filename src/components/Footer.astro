---
import type { Lang } from '../i18n/translations';
import { t } from '../i18n/translations';

interface Props {
  lang: Lang;
  currentPath: string;
  alternates?: { lang: string; url: string }[];
}

const { lang, currentPath, alternates } = Astro.props;
const year = new Date().getFullYear();

const aboutSlugs: Record<string, string> = {
  fr: 'a-propos', en: 'about', es: 'acerca-de', pt: 'sobre', it: 'chi-siamo',
};

const legalSlugs: Record<string, string> = {
  fr: 'mentions-legales', en: 'legal', es: 'aviso-legal', pt: 'aviso-legal', it: 'avviso-legale',
};

const partOfText: Record<string, string> = {
  fr: 'Un projet',
  en: 'A project by',
  es: 'Un proyecto de',
  pt: 'Um projeto de',
  it: 'Un progetto di',
};

const langFlags: Record<string, { flag: string; name: string }> = {
  fr: { flag: 'ðŸ‡«ðŸ‡·', name: 'FranÃ§ais' },
  en: { flag: 'ðŸ‡¬ðŸ‡§', name: 'English' },
  es: { flag: 'ðŸ‡ªðŸ‡¸', name: 'Espanol' },
  pt: { flag: 'ðŸ‡§ðŸ‡·', name: 'Portugues' },
  it: { flag: 'ðŸ‡®ðŸ‡¹', name: 'Italiano' },
};

function getPathForLang(targetLang: string): string {
  if (alternates) {
    const alt = alternates.find((a) => a.lang === targetLang);
    if (alt) return alt.url;
  }
  // If on a guide/review/compare page with no translation, link to lang homepage
  if (currentPath.match(/\/(guide|review|compare)\//)) {
    return `/${targetLang}/`;
  }
  const pathWithoutLang = currentPath.replace(/^\/(fr|en|es|pt|it)/, '');
  return `/${targetLang}${pathWithoutLang || '/'}`;
}
---

<footer class="footer">
  <div class="fg-container footer-inner">
    <div class="footer-brand">
      <span class="footer-logo" style="display:inline-flex;align-items:center;gap:0.3rem;">
<svg viewBox="0 0 512 512" width="24" height="24" aria-hidden="true"><g transform="translate(256, 280) scale(1.1)"><path d="M0,-120 C75,-120 110,-75 110,-15 C110,25 108,45 115,60 C120,70 118,65 112,75 C105,82 95,72 85,80 C75,90 70,100 55,100 C40,100 35,88 20,95 C5,102 5,102 0,102 C-5,102 -5,102 -20,95 C-35,88 -40,100 -55,100 C-70,100 -75,90 -85,80 C-95,72 -105,82 -112,75 C-118,65 -120,70 -115,60 C-108,45 -110,25 -110,-15 C-110,-75 -75,-120 0,-120 Z" fill="var(--fg-accent, #F4845F)"/><ellipse cx="-38" cy="-30" rx="24" ry="26" fill="var(--fg-bg-card, white)"/><ellipse cx="38" cy="-30" rx="24" ry="26" fill="var(--fg-bg-card, white)"/><path d="M-28,-115 C-33,-140 -45,-160 -48,-170" stroke="var(--fg-accent, #F4845F)" stroke-width="9" stroke-linecap="round" fill="none"/><circle cx="-49" cy="-178" r="13" fill="var(--fg-accent, #F4845F)"/><path d="M28,-115 C33,-140 45,-160 48,-170" stroke="var(--fg-accent, #F4845F)" stroke-width="9" stroke-linecap="round" fill="none"/><circle cx="49" cy="-178" r="13" fill="var(--fg-accent, #F4845F)"/></g></svg>
        <span class="logo-text">facil</span><span class="logo-dot">.</span><span class="logo-guide">guide</span>
      </span>
      <p class="footer-tagline">{t(lang, 'footer.tagline')}</p>
    </div>

    <div class="footer-lang">
      {Object.entries(langFlags).map(([code, { flag, name }]) => (
        <a
          href={getPathForLang(code)}
          class:list={['footer-lang-link', { active: code === lang }]}
          aria-label={name}
          hreflang={code}
        >
          <span class="footer-lang-flag">{flag}</span>
          <span class="footer-lang-name">{name}</span>
        </a>
      ))}
    </div>

    <nav class="footer-nav" aria-label={lang === 'fr' ? 'Navigation du pied de page' : 'Footer navigation'}>
      <a href={`/${lang}/`}>{t(lang, 'nav.home')}</a>
      <a href={`/${lang}/${aboutSlugs[lang]}/`}>{t(lang, 'nav.about')}</a>
      <a href={`/${lang}/${legalSlugs[lang]}/`}>{t(lang, 'nav.legal')}</a>
      <a href="mailto:facil@dropthe.org">facil@dropthe.org</a>
    </nav>

    <div class="footer-disclaimer">
      <p>{t(lang, 'footer.disclaimer')}</p>
      <p>{t(lang, 'footer.privacy')}</p>
    </div>

    <div class="footer-bottom">
      <p class="footer-copy">
        &copy; {year} facil.guide &mdash; {t(lang, 'footer.rights')}
      </p>
      <p class="footer-dropthe">
        {partOfText[lang]} <a href="https://dropthe.org" rel="noopener" target="_blank">DropThe</a>
      </p>
      <p class="footer-dropthe">
        <a href="https://dropthe.org/directory/?v=387cec752d77" title="Featured on DropThe Directory" rel="noopener" target="_blank">Featured on DropThe Directory</a>
      </p>
    </div>
  </div>
</footer>

<style>
  .footer {
    background: var(--fg-bg-card);
    border-top: 1px solid var(--fg-border);
    margin-top: auto;
    padding: 2.5rem 0;
    transition: background-color 0.2s ease;
  }

  .footer-inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.25rem;
    text-align: center;
  }

  .footer-logo { font-size: 1.25rem; font-weight: 700; }
  .logo-text { color: var(--fg-primary); }
  .logo-dot { color: var(--fg-accent); }
  .logo-guide { color: var(--fg-text); }

  .footer-tagline {
    color: var(--fg-text-muted);
    font-size: 0.95rem;
    margin-bottom: 0;
    margin-top: 0.25rem;
  }

  .footer-lang {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .footer-lang-link {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.5rem 0.85rem;
    border: 1px solid var(--fg-border);
    border-radius: 8px;
    text-decoration: none;
    color: var(--fg-text-light);
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.15s ease;
  }

  .footer-lang-link:hover {
    border-color: var(--fg-primary);
    color: var(--fg-primary);
    background: var(--fg-bg-warm);
  }

  .footer-lang-link.active {
    border-color: var(--fg-primary);
    color: var(--fg-primary);
    background: var(--fg-bg-warm);
    font-weight: 600;
  }

  .footer-lang-flag { font-size: 1.1rem; }
  .footer-lang-name { font-size: 0.85rem; }

  .footer-nav {
    display: flex;
    gap: 1.5rem;
  }

  .footer-nav a {
    color: var(--fg-text-light);
    text-decoration: none;
    font-weight: 500;
    min-height: 48px;
    display: inline-flex;
    align-items: center;
  }

  .footer-nav a:hover { color: var(--fg-primary); }

  .footer-disclaimer {
    max-width: 600px;
    padding: 0.75rem 1rem;
    border: 1px solid var(--fg-border);
    border-radius: 6px;
    background: var(--fg-bg);
  }

  .footer-disclaimer p {
    color: var(--fg-text-muted);
    font-size: 0.8rem;
    line-height: 1.5;
    margin: 0;
  }

  .footer-bottom {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
  }

  .footer-copy {
    color: var(--fg-text-muted);
    font-size: 0.85rem;
    margin-bottom: 0;
  }

  .footer-dropthe {
    color: var(--fg-text-muted);
    font-size: 0.8rem;
    margin-bottom: 0;
  }

  .footer-dropthe a {
    color: var(--fg-text-muted);
    font-weight: 600;
    text-decoration: none;
  }

  .footer-dropthe a:hover {
    color: var(--fg-primary);
  }
</style>
